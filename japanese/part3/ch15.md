# モナド・モノイド・圏

圏論の本を終えるのにふさわしいところというものはない。学ぶべきことは常にもっとある。圏論は広大な題材だ。一方で、同じテーマ・コンセプト・パターンが明らかに何度も繰り返されている。すべての概念はカン拡張である^[訳注：『圏論の基礎』第X章7節のこと。]という格言があるとおり、確かにカン拡張を使えば極限・余極限・モナド・米田の補題などを導出できる。圏の概念自体は抽象化のあらゆるレベルに現れる。モノイドとモナドの概念も同様だ。最も基本となるものはどれだろうか？　結局のところ、それらはすべて相互に関連しており、抽象化の終わりのないサイクルのなかで一方からもう一方が導かれる。それらの相互関係を示すことが、この本を締めくくるのにふさわしいだろうと判断した。

## 双圏

圏論で特に難しい側面の1つは、絶えず視点が切り替わることだ。たとえば、集合の圏を考えてみてほしい。我々は要素によって集合を定義することに慣れている。空集合には要素がない。単元集合には要素が1つある。2つの集合のデカルト積はペアの集合である、などなど。しかし、$\Set$圏について述べるとき、集合の内容を忘れて、代わりにそれらの間の射（矢）に集中するように求めた。だが時折、$\Set$内の特定の普遍的構成が要素の言葉でどう表現されるのかを知るため、カバーの下を覗くことが許された。そうして、終対象は実は単元集合であることなどが分かった。しかし、それらはサニティーチェックにすぎなかった。

関手は圏の写像として定義される。写像を圏内の射と見なすのは自然である。関手は、圏（サイズに関する問題を避けたいなら、小さい圏）の圏における射だった。関手を射として扱うと、圏の内部（対象と射）に対するその作用についての情報を代わりに失うことになる。これは、関数が集合の要素に対してどう作用するかの情報が、その関数を$\Set$内の射として扱うと代わりに失われるのと同じだ。その一方、任意の2つの圏の間の関手たちも圏をなす。今度は、ある圏の射であったものを別の圏の対象と見なすことが求められる。関手圏では関手が対象であり、自然変換が射だ。同一のものが、ある圏では射であり、別の圏では対象であり得ることが発見された。対象を名詞とし射を動詞とする素朴な考え方は成り立たない。

2つの観点を切り替える代わりに、1つの観点への統合を試みることもできる。そうすることで$\cat{2}$-圏の概念が得られる。この圏では、対象を$0$-セル、射を$1$-セル、射間の射を$2$-セルと呼ぶ。

![$0$-セル$a, b$、$1$-セル$f, g$、および$2$-セル$\alpha$。](images/twocat.png "$0$-セル$a, b$、$1$-セル$f, g$、および$2$-セル$\alpha$。"){width=35%}

\noindent
目下の例は圏の圏$\Cat$だ。圏が$0$-セル、関手が$1$-セル、自然変換が$2$-セルとなる。$\cat{2}$-圏の規則が示すのは、任意の2つの$0$-セル間の$1$-セルが圏をなす（言い換えると、［訳注：いま話している$2$-圏を$\cat{C}$と書くと］$\cat{C}(a, b)$ はhom集合ではなくhom圏である）ことだ。このことは、任意の2つの圏の間の関手は関手圏をなすという以前の主張とよく一致している。

特に、任意の$0$-セルからそれ自体に戻る$1$-セルもhom圏$\cat{C}(a, a)$ をなす。だが、その圏はさらなる構造を持っている。$\cat{C}(a, a)$ のメンバーは、$\cat{C}$内の射とも$\cat{C}(a, a)$ 内の対象とも見なせる。これらは射なので互いに合成できる。しかし、それらを対象として見ると、合成は対象のペアから対象への写像になる。実際、それは積に――正確にはテンソル積に――非常によく似ている。このテンソル積は恒等$1$-セルという単位元を持つ。任意の$\cat{2}$-圏において、hom圏$\cat{C}(a, a)$ は自動的に、テンソル積が$1$-セルの合成として定義されるようなモノイダル圏になる。結合律と単位律は、対応する圏の規則から単に成り立つ。

これが何を意味するのかを、$\cat{2}$-圏のカノニカルな例である$\Cat$で見てみよう。hom圏$\Cat(a, a)$ は$a$上の自己関手の圏だ。その中では、自己関手の合成がテンソル積の役割を果たす。恒等関手はこの積の単位元だ。自己関手がモノイダル圏をなすことは以前にも見た（その事実をモナドの定義で使った）が、これはもっと一般的な現象なのだ。つまり、任意の$\cat{2}$-圏において自己-$1$-セルはモノイダル圏をなす。これについては、後でモナドを一般化するときに再度説明する。

覚えているかもしれないが、一般のモノイダル圏では、モノイド則がきっちりと満たされていることは主張しなかった。多くの場合、単位律と結合律が同型を除いて満たされていれば十分だった。$\cat{2}$-圏では、$\cat{C}(a, a)$ のモノイド則は$1$-セルの合成律から導かれる。これらの規則は厳密なので、厳密モノイダル圏が常に得られる。しかし、これらの規則も緩和できる。たとえば、恒等$1$-セル$\idarrow[a]$と別の$1$-セル$f \Colon a \to b$の合成は、$f$と等しいのではなく、同型なのだと主張できる。$1$-セルの同型は$2$-セルを用いて定義される。つまり、次のような$2$-セル
$$\rho \Colon f \circ \idarrow[a] \to f$$
と、その逆が存在する。

![双圏の恒等律は同型（可逆な$2$-セル$\rho$）を除いて成り立つ。](images/bicat.png "双圏の恒等律は同型（可逆な$2$-セル$\rho$）を除いて成り立つ。"){width=35%}

\noindent
左恒等射と結合律についても同じことができる。このような緩和された$\cat{2}$-圏は双圏と呼ばれる（いくつか追加のコヒーレンス則があるが、ここでは省略する）。

予想どおり、双圏での自己-$1$-セルは、規則が厳密でない一般化されたモノイダル圏をなす。

双圏の興味深い例としてスパンの圏が挙げられる。2つの対象$a$と$b$の間のスパンは、対象$x$および次の1対の射だ。
$$
\begin{gathered}
f \Colon x \to a \\
g \Colon x \to b
\end{gathered}
$$

`\begin{figure}[H] \centering`{=latex}
![](images/span.png){width=35%}
`\end{figure}`{=latex}

\noindent
圏論的な積の定義でスパンを使ったことを覚えているかもしれない。ここでは、スパンを双圏での$1$-セルと見なしたい。最初のステップは、スパンの合成を定義することだ。隣接したスパンがあるとする。
$$
\begin{gathered}
f' \Colon y \to b \\
g' \Colon y \to c
\end{gathered}
$$

`\begin{figure}[H] \centering`{=latex}
![](images/compspan.png){width=50%}
`\end{figure}`{=latex}

\noindent
それらの合成はある$z$を頂点とするような第3のスパンになるだろう。最も自然な選択は、$f'$に沿った$g$の引き戻しだ。引き戻しとは対象$z$に2つの射
$$
\begin{gathered}
h \Colon z \to x \\
h' \Colon z \to y
\end{gathered}
$$
ただし、
$$g \circ h = f' \circ h'$$
を伴ったもので、そのような対象すべての中で普遍なものであることを思い出してほしい。

`\begin{figure}[H] \centering`{=latex}
![](images/pullspan.png){width=35%}
`\end{figure}`{=latex}

\noindent
ここでは、集合の圏でのスパンに注目しよう。この場合、引き戻しはデカルト積$x \times y$からのペア $(p, q)$ のうち次を満たすものの集合となる。
$$g\ p = f'\ q$$
同じ端点を共有する2つのスパンの間の射は頂点間の射$h$として定義され、適切な三角形を可換にする。

![$\cat{Span}$内の$2$-セル。](images/morphspan.png "$\cat{Span}$内の$2$-セル。"){width=35%}

\noindent
まとめると、双圏$\cat{Span}$では、$0$-セルは集合、$1$-セルはスパン、$2$-セルはスパン間の射だ。恒等$1$-セルは、3つの対象すべてが同じで、2つの射が恒等射であるような退化 (degenerate) したスパンだ。

双圏の別の例もすでに見ている。それは[プロ関手](#ends-and-coends)の双圏$\cat{Prof}$であり、$0$-セルは圏、$1$-セルはプロ関手、$2$-セルは自然変換だ。プロ関手の合成はコエンドによって与えられる。

## モナド

ここまでで、自己関手の圏におけるモノイドとしてのモナドの定義にかなり精通しているはずだ。この定義を、自己関手の圏は双圏$\Cat$内の自己-$1$-セルの取るに足らないhom圏のひとつにすぎないという新たな理解に沿って再検討してみよう。自己関手の圏がモノイダル圏であることは知っている。そのテンソル積は自己関手の合成に由来する。モノイドは、モノイダル圏内の対象――ここでは自己関手$T$――が2つの射を伴ったものとして定義される。自己関手間の射は自然変換だ。一方の射はモノイドの単位元――恒等自己関手――を$T$に写す。
$$\eta \Colon I \to T$$
もう一方の射はテンソル積$T \otimes T$を$T$に写す。このテンソル積は自己関手の合成によって与えられるため、次が得られる。
$$\mu \Colon T \circ T \to T$$

`\begin{figure}[H] \centering`{=latex}
![](images/monad.png){width=30%}
`\end{figure}`{=latex}

\noindent
これらがモナドを定義する2つの操作である（Haskellでは`return`および`join`と呼ばれる）ことが確認でき、そしてモノイド則がモナド則になったことが分かる。

さて、この定義から自己関手に関する記述をすべて取り除いていこう。まず双圏$\cat{C}$から始めて、その中で$0$-セル$a$を選ぶ。すでに見たように、hom圏$\cat{C}(a, a)$ はモノイダル圏だ。したがって、$\cat{C}(a, a)$ のモノイドを、$1$-セル$T$、および2つの$2$-セル
$$
\begin{gathered}
\eta \Colon I \to T \\
\mu \Colon T \circ T \to T
\end{gathered}
$$
でモノイド則を満たすものとして定義できる。*これのことを*モナドと呼ぶ。

`\begin{figure}[H] \centering`{=latex}
![](images/bimonad.png){width=30%}
`\end{figure}`{=latex}

\noindent
これは、$0$-セルと$1$-セルと$2$-セルだけを用いた、はるかに一般的なモナドの定義になっている。双圏$\Cat$に適用すると、これは単に通常のモナドになる。だが、他の双圏では何が起こるか見てみよう。

$\cat{Span}$でモナドを構築してみよう。ここでは$0$-セルを選択する。これは集合であり、すぐ明らかになる理由から、$\mathit{Ob}$と呼ぶことにする。次に、自己-$1$-セル（$\mathit{Ob}$から$\mathit{Ob}$へ戻るスパン）を選択する。その頂点には$\mathit{Arr}$と呼ぶことにする集合があり、次の2つの関数を伴う。
$$
\begin{gathered}
\mathit{dom} \Colon \mathit{Arr} \to \mathit{Ob} \\
\mathit{cod} \Colon \mathit{Arr} \to \mathit{Ob}
\end{gathered}
$$

`\begin{figure}[H] \centering`{=latex}
![](images/spanmonad.png){width=30%}
`\end{figure}`{=latex}

\noindent
集合$\mathit{Arr}$の要素を「射」と呼ぶことにしよう。さらに、$\mathit{Ob}$の要素を「対象」と呼ぶことにする、と言えば、目的地の手掛かりになるだろうか。2つの関数$\mathit{dom}$と$\mathit{cod}$は、域と余域を「射」に割り当てる。

このスパンをモナドにするには2つの$2$-セル$\eta$と$\mu$が必要だ。この場合のモノイドの単位元は、$\mathit{Ob}$から$\mathit{Ob}$への自明なスパンであり、頂点は$\mathit{Ob}$で、2つの恒等関数を伴う。$2$-セル$\eta$は頂点$\mathit{Ob}$と$\mathit{Arr}$との間の関数だ。つまり、$\eta$は「射」をすべての「対象」に割り当てる。$\cat{Span}$の$2$-セルは可換条件を満たす必要がある。ここでは次のようになる。
$$
\begin{gathered}
\mathit{dom} \circ \eta = \id \\
\mathit{cod} \circ \eta = \id
\end{gathered}
$$

`\begin{figure}[H] \centering`{=latex}
![](images/spanunit.png){width=40%}
`\end{figure}`{=latex}

\noindent
成分としては、これは次のようになる。
$$\mathit{dom}\ (\eta\ \mathit{ob}) = \mathit{ob} = \mathit{cod}\ (\eta\ \mathit{ob})$$
ここで、$\mathit{ob}$は$\mathit{Ob}$内の「対象」だ。言い換えると、$\eta$はすべての「対象」に域と余域がその「対象」であるような「射」を割り当てる。この特別な「射」が「恒等射」と呼ばれる。

2番目の$2$-セル$\mu$は、スパン$\mathit{Arr}$のそれ自身との合成に作用する。合成は引き戻しとして定義されているため、その要素は$\mathit{Arr}$からの要素のペア――「射」のペア $(a_1, a_2)$ だ。引き戻し条件は次のとおりだ。
$$\mathit{cod}\ a_1 = \mathit{dom}\ a_2$$
$a_2$と$a_1$が「合成可能」だと言うことにする。これは、一方の域が他方の余域だからだ。

`\begin{figure}[H] \centering`{=latex}
![](images/spanmul.png){width=50%}
`\end{figure}`{=latex}

\noindent
$2$-セル$\mu$は、合成可能な「射」のペア $(a_1, a_2)$ を、$\mathit{Arr}$からの単一の「射」$a_3$に写す関数だ。言い換えると、$\mu$は「射」の合成を定義する。

モナド則が射の恒等律や結合律に対応していることは簡単に確認できる。以上で圏（対象と射が集合をなしている、小さい圏であることに注意）を定義できたことになる。

つまり、まとめると、圏はスパンの双圏におけるモナドにすぎない。

この結果の驚くべき点は、圏がモナドやモノイドのような他の代数的構造と同じ基盤に置かれていることだ。圏であることは何も特別ではない。ただの2つの集合と4つの関数だ。実際に、対象ごとに個別の集合さえ必要ない。対象は恒等射と同一視できる（それらは1対1で対応している）からだ。つまり、実際にはひとつの集合といくつかの関数にすぎない。圏論がすべての数学において中心的役割を担っていることを考えると、これにはとても謙虚な気持ちにさせられる。

## 課題

1. 双圏における自己-$1$-セルの合成として定義されたテンソル積について、単位律と結合律を導出せよ。
2. $\cat{Span}$内のモナドについて、モナド則が、結果の圏における恒等射と結合律に対応していることを確認せよ。
3. $\cat{Prof}$内のモナドが対象について恒等 (identity-on-object) な関手であることを示せ。
4. $\cat{Span}$内のモナドについてのモナド代数とは何か？

## 参考文献

1. [Paweł Sobocińskiのブログ](https://graphicallinearalgebra.net/2017/04/16/a-monoid-is-a-category-a-category-is-a-monad-a-monad-is-a-monoid/)^[<https://graphicallinearalgebra.net/2017/04/16/a-monoid-is-a-category-a-category-is-a-monad-a-monad-is-a-monoid/>]
